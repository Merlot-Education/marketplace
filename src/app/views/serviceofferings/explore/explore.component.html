<div *ngIf="orgaOfferings.length > 0 || applyStatusFilter">

<h1>Service Angebote meiner Organisation</h1>

<div style="padding:10px">
  <c-form-check [inline]="true" switch sizing="xl">
    <input cFormCheckInput id="filterCheck" type="checkbox" [(ngModel)]="applyStatusFilter" (change)="filterByStatus(applyStatusFilter, selectedStatusFilter)"/>
    <label cFormCheckLabel for="filterCheck">Zeige nur Angebote mit Status: </label>
  </c-form-check> <br/>
  <select class="form-select" (change)="selectedStatusFilter = $event.target.value; filterByStatus(applyStatusFilter, selectedStatusFilter)">
    <option *ngFor="let option of objectKeys(friendlyStatusNames)" [value]="option">{{friendlyStatusNames[option]}}</option>
  </select>
</div>

<c-row [xl]="3">
  <c-col xs *ngFor="let offering of orgaOfferings">
    <c-card class="mb-4">
      <c-card-header><b>{{ resolveTypeFriendlyName(offering.type) }}</b>: {{ offering.name }}</c-card-header>
      <c-card-body>
        <c-row>
          <c-col>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" style="border: none">
                <strong>Service ID:</strong> <br />
                {{ offering.id }}
              </li>
              <li class="list-group-item" style="border: none">
                <strong>Erstelldatum:</strong><br />
                {{ offering.creationDate }}
              </li>
              <li class="list-group-item" style="border: none">
                <strong>Anbieter:</strong><br />
                {{ organizationsApiService.resolveOrganizationLegalName(offering.offeredBy) }}
              </li>
              <li class="list-group-item" style="border: none">
                <strong>Status:</strong><br />
                {{ resolveMerlotStatusFriendlyName(offering.merlotState) }}
              </li>
            </ul>
            <div style="padding: 10px">
              <button type="button" class="btn btn-primary flex-item-grow" [cModalToggle]="modalViewDetails.id" (click)="selectedOfferingPublic = false; requestDetails(offering.id)">
                Details
              </button>
              <button type="button" class="btn btn-primary flex-item-grow" [cModalToggle]="modalEditServiceOffering.id" (click)="updateServiceOfferingEdit(offering)" *ngIf="offering.merlotState === 'IN_DRAFT'">
                Bearbeiten
              </button>
            </div>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<c-pagination align="left" aria-label="Page navigation example">
  <div cPageItem [disabled]="pageOption.disabled" [active]="pageOption.active" *ngFor="let pageOption of orgaOfferingPages">
    <a cPageLink [routerLink] (click)="handleOrgaPageNavigation(pageOption)">{{ pageOption.text }}</a>
  </div>
</c-pagination>

</div>


<div *ngIf="offerings.length > 0">
<h1>Öffentliche Service Angebote</h1>

<c-row [xl]="3">
  <c-col xs *ngFor="let offering of offerings">
    <c-card class="mb-4">
      <c-card-header><b>{{ resolveTypeFriendlyName(offering.type) }}</b>: {{ offering.name }}</c-card-header>
      <c-card-body>
        <c-row>
          <c-col>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" style="border: none">
                <strong>Service ID:</strong> <br />
                {{ offering.id }}
              </li>
              <li class="list-group-item" style="border: none">
                <strong>Erstelldatum:</strong><br />
                {{ offering.creationDate }}
              </li>
              <li class="list-group-item" style="border: none">
                <strong>Anbieter:</strong><br />
                {{ organizationsApiService.resolveOrganizationLegalName(offering.offeredBy) }}
              </li>
            </ul>
            <div style="padding: 10px">
              <button type="button" class="btn btn-primary flex-item-grow" *ngIf="authService.isLoggedIn" [cModalToggle]="modalViewDetails.id" (click)="selectedOfferingPublic = true; requestDetails(offering.id)">
                Details
              </button>
              <button type="button" class="btn btn-primary flex-item-grow" *ngIf="authService.isLoggedIn" [cModalToggle]="modalViewContract.id" (click)="selectedOfferingPublic = true; requestDetails(offering.id)">
                Buchen
              </button>
            </div>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<c-pagination align="left" aria-label="Page navigation example">
  <div cPageItem [disabled]="pageOption.disabled" [active]="pageOption.active" *ngFor="let pageOption of publicOfferingPages">
    <a cPageLink [routerLink] (click)="handlePublicPageNavigation(pageOption)">{{ pageOption.text }}</a>
  </div>
</c-pagination>

</div>

<h1 *ngIf="orgaOfferings.length === 0 && offerings.length === 0">Es konnten keine Service Angebote gefunden werden.</h1>

<c-modal #modalViewDetails id="modalViewDetails" size="xl" alignment="center" (visibleChange)="handleEventDetailsModal($event)">
  <c-modal-header>
    <h5 cModalTitle>Details zum Service Angebot "{{ selectedOfferingDetails.id }}"</h5>
  </c-modal-header>
  <c-modal-body>
    <ul class="list-group list-group-flush">
      <li class="list-group-item" style="border: none">
        <strong>Angebotstyp:</strong> <br />
        {{ resolveTypeFriendlyName(selectedOfferingDetails.type) }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Service ID:</strong> <br />
        {{ selectedOfferingDetails.id }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Name:</strong> <br />
        {{ selectedOfferingDetails.name }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Erstelldatum:</strong><br />
        {{ selectedOfferingDetails.creationDate }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Anbieter:</strong><br />
        {{ organizationsApiService.resolveOrganizationLegalName(selectedOfferingDetails.offeredBy) }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Status:</strong><br />
        {{ resolveMerlotStatusFriendlyName(selectedOfferingDetails.merlotState) }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.description !== null">
        <strong>Beschreibung:</strong><br />
        {{ selectedOfferingDetails.description }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Letzte Änderung:</strong><br />
        {{ selectedOfferingDetails.modifiedDate }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Datenzugriffsart:</strong><br />
        {{ selectedOfferingDetails.dataAccessType }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.exampleCosts !== null">
        <strong>Beispielkosten:</strong><br />
        {{ selectedOfferingDetails.exampleCosts }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.attachments !== null">
        <strong>Anhänge:</strong><br />
        <ul *ngFor="let attachment of selectedOfferingDetails.attachments">
          <li>
            <a [href]="attachment">{{ attachment }}</a>
          </li>
        </ul>
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Allgemeine Geschäftsbedingungen:</strong><br />
        <ul *ngFor="let tnc of selectedOfferingDetails.termsAndConditions">
          <li>
            <a [href]="tnc.content">{{ tnc.content }}</a> (Hash: {{ tnc.hash }})
          </li>
        </ul>
        
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Laufzeitoptionen:</strong><br />
        <ul *ngFor="let rt of selectedOfferingDetails.runtimeOption">
          <li>
          <div *ngIf="rt.runtimeUnlimited">Unbegrenzt</div>
          <div *ngIf="!rt.runtimeUnlimited">
            {{ rt.runtimeCount }} {{ rt.runtimeMeasurement }}
          </div>
          </li>
        </ul>
        
      </li>
      <div *ngIf="selectedOfferingDetails.type === 'merlot:MerlotServiceOfferingSaaS'">
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.hardwareRequirements !== null">
          <strong>Hardware-Anforderungen:</strong><br />
          {{ selectedOfferingDetails.hardwareRequirements }}
        </li>
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.userCountOption !== null">
          <strong>Optionen für Anzahl erlaubter Benutzer:</strong><br />
          <ul *ngFor="let auc of selectedOfferingDetails.userCountOption">
            <li>
            <div *ngIf="auc.userCountUnlimited">Unbegrenzt</div>
            <div *ngIf="!auc.userCountUnlimited">
              Bis zu {{ auc.userCountUpTo }} Benutzer
            </div>
            </li>
          </ul>
        </li>
      </div>
      <div *ngIf="selectedOfferingDetails.type === 'merlot:MerlotServiceOfferingDataDelivery'">
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.exchangeCountOption !== null">
          <strong>Optionen für Anzahl erlaubter Datenaustausche:</strong><br />
          <ul *ngFor="let dec of selectedOfferingDetails.exchangeCountOption">
            <li>
            <div *ngIf="dec.exchangeCountUnlimited">Unbegrenzt</div>
            <div *ngIf="!dec.exchangeCountUnlimited">
              Bis zu {{ dec.exchangeCountUpTo }} Datenaustausche
            </div>
            </li>
          </ul>
        </li>
      </div>
      
    </ul>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" [cModalToggle]="modalViewDetails.id">Schließen</button>
    <button type="button" class="btn btn-primary flex-item-grow" 
    *ngIf="!selectedOfferingPublic && selectedOfferingDetails.merlotState === 'REVOKED'"
    (click)="inDraftOffering(selectedOfferingDetails.id)"
    >
      Entwurf 
    </button>
    <button type="button" class="btn btn-primary flex-item-grow" 
    *ngIf="!selectedOfferingPublic && (selectedOfferingDetails.merlotState === 'IN_DRAFT') || (selectedOfferingDetails.merlotState === 'REVOKED')"
    (click)="releaseOffering(selectedOfferingDetails.id)"
    >
      Veröffentlichen
    </button>
    <button type="button" class="btn btn-primary flex-item-grow" 
    *ngIf="!selectedOfferingPublic && selectedOfferingDetails.merlotState === 'RELEASED'"
    (click)="revokeOffering(selectedOfferingDetails.id)"
    >
      Widerrufen
    </button>
    <button type="button" class="btn btn-primary flex-item-grow" 
    *ngIf="!selectedOfferingPublic && (selectedOfferingDetails.merlotState === 'IN_DRAFT') || (selectedOfferingDetails.merlotState === 'REVOKED')"
    (click)="deleteOffering(selectedOfferingDetails.id)"
    >
      Löschen
    </button>
  </c-modal-footer>
</c-modal>

<c-modal #modalEditServiceOffering id="modalEditServiceOffering" size="xl" alignment="center" (visibleChange)="handleEventEditModal($event)">
  <c-modal-header>
    <h5 cModalTitle>Service Angebot "{{ selectedOfferingDetails.name }}" bearbeiten</h5>
  </c-modal-header>
  <c-modal-body>
    <app-dynamic-form [file]="shaclFile" [prefillData]="selectedOfferingDetails"></app-dynamic-form>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" [cModalToggle]="modalEditServiceOffering.id">Schließen</button>
  </c-modal-footer>
</c-modal>

<c-modal #modalViewContract id="modalViewContract" size="xl" alignment="center" (visibleChange)="handleEventContractModal($event)">
  <c-modal-header>
    <h5 cModalTitle>Vertragskonfiguration zum Service Angebot "{{ selectedOfferingDetails.id }}"</h5>
  </c-modal-header>
  <c-modal-body>
    <ul class="list-group list-group-flush">
      <li class="list-group-item" style="border: none">
        <strong>Angebotstyp:</strong> <br />
        {{ resolveTypeFriendlyName(selectedOfferingDetails.type) }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Service ID:</strong> <br />
        {{ selectedOfferingDetails.id }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Name:</strong> <br />
        {{ selectedOfferingDetails.name }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Anbieter:</strong><br />
        {{ organizationsApiService.resolveOrganizationLegalName(selectedOfferingDetails.offeredBy) }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.description !== null">
        <strong>Beschreibung:</strong><br />
        {{ selectedOfferingDetails.description }}
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Datenzugriffsart:</strong><br />
        {{ selectedOfferingDetails.dataAccessType }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.exampleCosts !== null">
        <strong>Beispielkosten:</strong><br />
        {{ selectedOfferingDetails.exampleCosts }}
      </li>
      <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.attachments !== null">
        <strong>Anhänge:</strong><br />
        <ul *ngFor="let attachment of selectedOfferingDetails.attachments">
          <li>
            <a [href]="attachment">{{ attachment }}</a>
          </li>
        </ul>
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Service-Angebot-spezifische AGB:</strong><br />
        <ul *ngFor="let tnc of selectedOfferingDetails.termsAndConditions">
          <li>
            <a [href]="tnc.content">{{ tnc.content }}</a> (Hash: {{ tnc.hash }})
          </li>
        </ul>
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Anbieter AGB:</strong><br />
          <a [href]="'http://example.com'">http://example.com</a> (Hash: 1234)
      </li>
      <li class="list-group-item" style="border: none">
        <strong>Laufzeit*:</strong><br />
        <select class="form-select">
          <ng-container *ngFor="let rt of selectedOfferingDetails.runtimeOption">
            <option *ngIf="!rt.runtimeUnlimited" [value]="rt.runtimeCount + ' ' + rt.runtimeMeasurement">{{ rt.runtimeCount }} {{ rt.runtimeMeasurement }}</option>
            <option *ngIf="rt.runtimeUnlimited" [value]="'unlimited'">Unbegrenzte Laufzeit</option>
          </ng-container>
        </select>
        
      </li>
      <div *ngIf="selectedOfferingDetails.type === 'merlot:MerlotServiceOfferingSaaS'">
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.hardwareRequirements !== null">
          <strong>Hardware-Anforderungen:</strong><br />
          {{ selectedOfferingDetails.hardwareRequirements }}
        </li>
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.userCountOption !== null">
          <strong>Anzahl erlaubter Benutzer*:</strong><br />
          <select class="form-select">
            <ng-container *ngFor="let auc of selectedOfferingDetails.userCountOption">
              <option *ngIf="!auc.userCountUnlimited" [value]="auc.userCountUpTo ">Bis zu {{ auc.userCountUpTo }} Benutzer</option>
              <option *ngIf="auc.userCountUnlimited" [value]="'unlimited'">Unbegrenzt viele Benutzer</option>
            </ng-container>
          </select>
        </li>
      </div>
      <div *ngIf="selectedOfferingDetails.type === 'merlot:MerlotServiceOfferingDataDelivery'">
        <li class="list-group-item" style="border: none" *ngIf="selectedOfferingDetails.exchangeCountOption !== null">
          <strong>Anzahl erlaubter Datenaustausche*:</strong><br />
          <select class="form-select">
            <ng-container *ngFor="let dec of selectedOfferingDetails.exchangeCountOption">
              <option *ngIf="!dec.exchangeCountUnlimited" [value]="dec.exchangeCountUpTo ">Bis zu {{ dec.exchangeCountUpTo }} Datenaustausche</option>
              <option *ngIf="dec.exchangeCountUnlimited" [value]="'unlimited'">Unbegrenzt viele Datenaustausche</option>
            </ng-container>
          </select>
        </li>
      </div>
      <li class="list-group-item" style="border: none">
        <div class="mb-3">
          <label class="form-label"><strong>Zusatzvereinbarungen</strong></label>
          <input class="form-control" placeholder="Zusatzvereinbarungen" [disabled]="true"/>
        </div>
      </li>
      <li class="list-group-item" style="border: none">
        <c-form-check inline>
          <input cFormCheckInput id="checkAGB" type="checkbox" />
          <label cFormCheckLabel for="checkAGB" style="padding-left: 10px;"><b>Anbieter AGB gelesen und akzeptiert*</b></label>
        </c-form-check>
      </li>
      <li class="list-group-item" style="border: none">
        <c-form-check inline>
          <input cFormCheckInput id="checkMerlotAGB" type="checkbox" />
          <label cFormCheckLabel for="checkMerlotAGB" style="padding-left: 10px;"><b>Merlot AGB gelesen und akzeptiert*</b></label>
        </c-form-check>
      </li>

      <li class="list-group-item" style="border: none">
        <c-form-check inline>
          <input cFormCheckInput id="checkSpecificAGB" type="checkbox" />
          <label cFormCheckLabel for="checkSpecificAGB" style="padding-left: 10px;"><b>Service-Angebot-spezifische AGB gelesen und akzeptiert*</b></label>
        </c-form-check>
      </li>
      
    </ul>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" [cModalToggle]="modalViewContract.id">Schließen</button>
    <button cButton disabled color="primary">Vertragsentwurf speichern</button>
    <button cButton disabled color="primary">Vertragsentwurf löschen</button>
    <button cButton disabled color="primary">Kostenpflichtig bestellen</button>
  </c-modal-footer>
</c-modal>


